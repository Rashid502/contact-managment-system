{"ast":null,"code":"import _regeneratorRuntime from\"D:\\\\Rashid_Work\\\\API Projects\\\\contact-manager-api\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"D:\\\\Rashid_Work\\\\API Projects\\\\contact-manager-api\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:\\\\Rashid_Work\\\\API Projects\\\\contact-manager-api\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useReducer,useEffect}from\"react\";import axios from\"axios\";import AuthContext from\"./authContext\";import AuthReducer from\"./AuthReducer\";import setAuthToken from\"../../utils/setAuthToken\";import{REGISTER_SUCCESS,REGISTER_FAIL,USER_LOADED,AUTH_ERROR,LOGIN_SUCCESS,LOGIN_FAIL,LOGOUT,CLEAR_ERRORS}from\"../types\";var AuthState=function AuthState(props){var initialState={token:localStorage.getItem(\"token\"),isAuthenticated:null,loading:true,user:null,error:null};var _useReducer=useReducer(AuthReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];useEffect(function(){if(localStorage.token){loadUser();}},[]);//Load User\nvar loadUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setAuthToken(localStorage.token);_context.prev=1;_context.next=4;return axios.get(\"/api/auth\");case 4:res=_context.sent;dispatch({type:USER_LOADED,payload:res.data});_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);dispatch({type:AUTH_ERROR});case 11:case\"end\":return _context.stop();}}},_callee,null,[[1,8]]);}));return function loadUser(){return _ref.apply(this,arguments);};}();//Register User\nvar register=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(formData){var config,res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:config={headers:{\"Content-Type\":\"application/json\"}};_context2.prev=1;_context2.next=4;return axios.post(\"/api/user\",formData,config);case 4:res=_context2.sent;dispatch({type:REGISTER_SUCCESS,payload:res.data});loadUser();//  console.log(res.data);\n_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](1);dispatch({type:REGISTER_FAIL,payload:_context2.t0.response.data.msg});case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[1,9]]);}));return function register(_x){return _ref2.apply(this,arguments);};}();//Login User\nvar login=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(formData){var config,res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:config={headers:{\"Content-Type\":\"application/json\"}};_context3.prev=1;_context3.next=4;return axios.post(\"api/auth\",formData,config);case 4:res=_context3.sent;dispatch({type:LOGIN_SUCCESS,payload:res.data});console.log(res.data);loadUser();_context3.next=13;break;case 10:_context3.prev=10;_context3.t0=_context3[\"catch\"](1);dispatch({type:LOGIN_FAIL,payload:_context3.t0.response.data.msg});case 13:case\"end\":return _context3.stop();}}},_callee3,null,[[1,10]]);}));return function login(_x2){return _ref3.apply(this,arguments);};}();//Logout User\nvar logout=function logout(){dispatch({type:LOGOUT});};//Clear errors\nvar clearErrors=function clearErrors(){dispatch({type:CLEAR_ERRORS});};return/*#__PURE__*/React.createElement(AuthContext.Provider,{value:{token:state.token,isAuthenticated:state.isAuthenticated,user:state.user,loading:state.loading,error:state.error,register:register,loadUser:loadUser,login:login,logout:logout,clearErrors:clearErrors}},props.children);};export default AuthState;","map":{"version":3,"sources":["D:/Rashid_Work/API Projects/contact-manager-api/client/src/context/auth/AuthState.js"],"names":["React","useReducer","useEffect","axios","AuthContext","AuthReducer","setAuthToken","REGISTER_SUCCESS","REGISTER_FAIL","USER_LOADED","AUTH_ERROR","LOGIN_SUCCESS","LOGIN_FAIL","LOGOUT","CLEAR_ERRORS","AuthState","props","initialState","token","localStorage","getItem","isAuthenticated","loading","user","error","state","dispatch","loadUser","get","res","type","payload","data","register","formData","config","headers","post","response","msg","login","console","log","logout","clearErrors","children"],"mappings":"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","sourcesContent":["import React, {useReducer, useEffect} from \"react\";\r\nimport axios from \"axios\";\r\nimport AuthContext from \"./authContext\";\r\nimport AuthReducer from \"./AuthReducer\";\r\nimport setAuthToken from \"../../utils/setAuthToken\";\r\n\r\nimport {\r\n  REGISTER_SUCCESS,\r\n  REGISTER_FAIL,\r\n  USER_LOADED,\r\n  AUTH_ERROR,\r\n  LOGIN_SUCCESS,\r\n  LOGIN_FAIL,\r\n  LOGOUT,\r\n  CLEAR_ERRORS,\r\n} from \"../types\";\r\n\r\nconst AuthState = (props) => {\r\n  const initialState = {\r\n    token: localStorage.getItem(\"token\"),\r\n    isAuthenticated: null,\r\n    loading: true,\r\n    user: null,\r\n    error: null,\r\n  };\r\n  const [state, dispatch] = useReducer(AuthReducer, initialState);\r\n\r\n  useEffect(() => {\r\n    if (localStorage.token) {\r\n      loadUser();\r\n    }\r\n  },[]);\r\n  //Load User\r\n  const loadUser = async () => {\r\n    setAuthToken(localStorage.token);\r\n\r\n    try {\r\n      const res = await axios.get(\"/api/auth\");\r\n      dispatch({\r\n        type: USER_LOADED,\r\n        payload: res.data,\r\n      });\r\n    } catch (err) {\r\n      dispatch({\r\n        type: AUTH_ERROR,\r\n      });\r\n    }\r\n  };\r\n\r\n  //Register User\r\n  const register = async (formData) => {\r\n    const config = {\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n    };\r\n    try {\r\n      const res = await axios.post(\"/api/user\", formData, config);\r\n      dispatch({\r\n        type: REGISTER_SUCCESS,\r\n        payload: res.data,\r\n      });\r\n      loadUser();\r\n      //  console.log(res.data);\r\n    } catch (err) {\r\n      dispatch({\r\n        type: REGISTER_FAIL,\r\n        payload: err.response.data.msg,\r\n      });\r\n    }\r\n  };\r\n\r\n  //Login User\r\n  const login = async (formData) => {\r\n    const config = {\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n    };\r\n    try {\r\n      const res = await axios.post(\"api/auth\", formData, config);\r\n      dispatch({\r\n        type: LOGIN_SUCCESS,\r\n        payload: res.data,\r\n      });\r\n      console.log(res.data);\r\n      loadUser();\r\n    } catch (err) {\r\n      dispatch({type: LOGIN_FAIL, payload: err.response.data.msg});\r\n    }\r\n  };\r\n\r\n  //Logout User\r\n  const logout = () => {\r\n    dispatch({\r\n      type: LOGOUT,\r\n    });\r\n  };\r\n\r\n  //Clear errors\r\n  const clearErrors = () => {\r\n    dispatch({type: CLEAR_ERRORS});\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        token: state.token,\r\n        isAuthenticated: state.isAuthenticated,\r\n        user: state.user,\r\n        loading: state.loading,\r\n        error: state.error,\r\n        register,\r\n        loadUser,\r\n        login,\r\n        logout,\r\n        clearErrors,\r\n      }}\r\n    >\r\n      {props.children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport default AuthState;\r\n"]},"metadata":{},"sourceType":"module"}